auto_venv() {
  setopt +o nomatch
  if [[ -n "$VIRTUAL_ENV" ]] && ! [[ $PWD =~ ^$(dirname $VIRTUAL_ENV).* ]]; then
    deactivate
  fi
  venv=$(ls $PWD/{,.}*/bin/activate 2>/dev/null)
  if [[ -n "${venv}" ]]; then
    source "${venv}"
  fi
  setopt -o nomatch
}
# Add chpwd hook to auto_venv
chpwd() {
  auto_venv
}
